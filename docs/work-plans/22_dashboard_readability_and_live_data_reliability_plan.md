# 22. 대시보드 가독성 개선 + 탭 실시간성(stale 데이터) 신뢰성 회복 계획

**작성일**: 2026-02-27  
**작성자**: Codex  
**상태**: Approval Pending  
**관련 계획 문서**: `docs/work-plans/18-03_dashboard_db_connection_pool_resilience_plan.md`, `docs/work-plans/16_overview_holdings_readability_enhancement.md`  
**승인 정보**: 승인자 / 승인 시각 / 승인 코멘트

---

## 0. 트리거(Why started)
- 운영/모니터링에서 무엇이 관측됐는지:
  - 현재 대시보드 가독성이 낮고, 이모지/장식 요소가 과도해 정보 전달 집중도가 떨어짐.
  - 일부 탭이 최신 상태를 즉시 반영하지 못해 기존 데이터가 남아 보이는(stale) 현상이 있음.
- 왜 즉시 대응이 필요했는지:
  - 실거래 전환 전 운영 판단은 대시보드 신뢰도에 의존하므로, UI 품질과 데이터 신선도 보장이 필요함.

## 1. 문제 요약
- 증상:
  - 정보 우선순위가 불명확(핵심 숫자 대비 시각 요소 과다)
  - 탭별 갱신 타이밍 불일치 및 오래된 데이터 표시
  - 운영자가 “현재 상태”인지 “과거 캐시”인지 즉시 구분하기 어려움
- 영향 범위(기능/리스크/데이터/비용):
  - 기능: 대시보드 운영 가독성 저하
  - 리스크: 잘못된 시점 데이터 기반 운영 판단 가능성
  - 데이터: 탭/컴포넌트별 freshness 불일치
  - 비용: 오판으로 인한 대응 시간/운영 비용 증가
- 재현 조건:
  - 앱 탭 이동 반복, 백엔드 갱신 직후, 장시간 실행 세션에서 stale 노출

## 2. 목표 / 비목표
### 2.1 목표
1. 대시보드 UI를 “장식 중심”에서 “운영 판단 중심”으로 재정렬
2. 모든 탭에 데이터 freshness 표시(마지막 갱신 시각, 갱신 소스, 지연 상태)
3. stale 데이터 조건을 명시적으로 탐지/표시하고 자동/수동 재조회 경로 제공
4. 실거래 전환 전, 운영자가 대시보드만 보고 현재 상태를 신뢰할 수 있게 함

### 2.2 비목표
1. 이번 계획에서 프론트엔드 프레임워크 전면 교체(예: Streamlit -> React)는 수행하지 않음
2. 신규 서비스(마이크로서비스) 추가는 범위 밖
3. 시각 디자인의 전면 리브랜딩은 범위 밖(운영 가독성 중심 개선만 수행)

## 3. 실행 게이트 (착수 시점 조건)
- 본 계획은 **즉시 구현이 아니라 “안정화 이후 착수”**를 전제로 함.
- 착수 조건(모두 충족 시 시작):
  1) 최근 7일 기준 P1 장애 0건
  2) 24h 모니터링 스크립트(`18-14`) 연속 PASS(치명 FAIL 0건)
  3) 실거래 전환 관련 핵심 기능(21번 스트림) 우선 항목 완료 또는 동결
  4) 대시보드 데이터 소스 스키마 변경 예정 없음(변경 freeze)

## 4. 대응 전략
- 단기 핫픽스:
  - 이모지/과장 텍스트 제거, 핵심 KPI 레이아웃 정리
- 근본 해결:
  - 탭별 데이터 조회/캐시/갱신 정책을 공통 모듈로 통합하고 freshness 계약을 강제
- 안전장치(가드레일/차단/쿨다운/timeout 등):
  - 데이터 age 임계치 초과 시 “stale 경고 배지 + 자동 재조회”
  - 조회 실패 시 마지막 정상 스냅샷 + 오류 사유 분리 표기

## 5. 아키텍처 선택/대안/트레이드오프
- 최종 선택(예정):
  - **기존 Streamlit 구조 유지 + 데이터 신선도 계층 공통화 + UI 가독성 리팩터**

- 고려 대안:
  1) 기존 페이지별 개별 수정(빠른 패치)
  2) Streamlit 유지 + 공통 데이터 계층/컴포넌트 정리(채택)
  3) 프레임워크 교체(React/Next 등)

- 대안 비교:
  1) 개별 수정:
    - 장점: 구현 속도 빠름
    - 단점: stale 원인 재발(중복 로직 유지)
  2) 공통 계층 정리(채택):
    - 장점: 재발 방지, 탭 간 일관성 확보
    - 단점: 초기 리팩터링 범위 증가
  3) 프레임워크 교체:
    - 장점: 장기 확장성
    - 단점: 현재 단계 과투자, 일정/리스크 급증

## 6. 구현/수정 내용 (예정)
- 변경 파일(예상):
  1) `src/dashboard/app.py`
  2) `src/dashboard/pages/*.py` (Overview/Market/Risk/History/System/Chatbot/Exit Analysis)
  3) `src/dashboard/components/*` (공통 KPI/경고/타임스탬프 컴포넌트)
  4) `src/dashboard/services/*` 또는 데이터 조회 공통 모듈(신규 가능)
  5) `docs/work-result/22_dashboard_readability_and_live_data_reliability_result.md` (신규)

- 작업 스트림:
  - Stream A: 정보 구조/타이포/컬러 정리(이모지 제거 포함)
  - Stream B: 탭별 freshness 계약(마지막 갱신 시각/age/갱신 버튼/자동 갱신)
  - Stream C: stale 탐지 로직 + 실패 fallback UI
  - Stream D: 운영 검증 체크리스트/스크린샷 기준선 정의

## 7. 검증 기준
- 재현 케이스에서 해결 확인:
  1) 탭 이동/장시간 세션에서도 stale 상태가 명시적으로 표시되거나 자동 해소됨
  2) 핵심 탭(Overview/Market/Risk)의 데이터 갱신 시각이 일관되게 노출됨
- 회귀 테스트:
  - 기존 데이터 조회 오류율 상승 없음
  - 기존 핵심 지표(positions/pnl/risk/api latency) 표시 유지
- 운영 체크:
  - 운영자 1차 사용성 점검(정보 찾기 시간/오판 가능성) 통과

## 8. 롤백
- 코드 롤백:
  - UI 리팩터 커밋 단위 revert
- 운영 롤백:
  - 공통 freshness 계층 비활성화 플래그(도입 시)로 즉시 회귀
- 데이터/스키마 롤백:
  - 없음(조회 경로 개선 중심)

## 9. 문서 반영
- work-plan/work-result 업데이트:
  - 본 계획서 + 구현 후 결과 문서 작성
- PROJECT_CHARTER.md 업데이트 필요 여부 및 반영 내역:
  - 대시보드 운영 정책(가독성/신선도 표준)을 “운영 규칙”으로 확정 시 Charter changelog 반영

## 10. 후속 조치
1. 대시보드 운영 스타일 가이드(문구/색/경고 레벨) 문서화  
2. stale 경고 발생 빈도 메트릭 수집(월간 개선 지표)  
3. 장기적으로 UI 기술 스택 전환 필요성 재평가(별도 에픽 분리)
