# 21-02. LLM 모델(Haiku vs GPT-4o-mini) 실시간 매매/비용 비교 문서화 계획

**작성일**: 2026-02-26  
**작성자**: Codex  
**상태**: Approved  
**관련 계획 문서**: `docs/work-plans/21_live_trading_transition_1m_krw_plan.md`  
**승인 정보**: 사용자 승인 / 2026-02-26 / "승인할게"

---

## 0. 트리거(Why started)
- 운영/모니터링에서 무엇이 관측됐는지:
  - 현재 실시간 매매 판단 경로의 기본 모델이 Haiku로 설정되어 있고, 일부 배치/리포트 경로는 GPT-4o-mini를 사용 중임.
  - 실거래 전환 전, 모델 선택 근거(성능/비용/API 크레딧 소모)를 명확히 문서화할 필요가 있음.
- 왜 즉시 대응이 필요했는지:
  - 실시간 판단 모델을 잘못 선택하면 지연시간/비용/안정성에 직접 영향이 발생함.

## 1. 문제 요약
- 증상:
  - "실시간 매매판단에서 Haiku가 GPT-4o-mini보다 적합한지"와 "사용량 대비 크레딧 소모"에 대한 단일 기준 문서가 없음.
- 영향 범위(기능/리스크/데이터/비용):
  - 기능: Analyst/Guardian/Router 등 실시간 추론 경로의 모델 전략
  - 리스크: 과도한 비용, 지연 증가, 판단 일관성 저하
  - 비용: 호출량이 높은 실시간 경로의 월간 크레딧 소모 추정 오차
- 재현 조건:
  - 운영자/개발자가 모델 전환 의사결정을 수행할 때 근거 문서가 부족한 상황

## 2. 원인 분석
- 가설:
  - 코드상 모델 역할 분리는 존재하지만, 비용/성능/용도 기준이 문서로 체계화되지 않았음.
- 조사 과정:
  - 코드 경로 기준 실제 사용 모델 식별
  - 공식 벤더 문서 기반 가격/토큰 단가 확인
  - 실시간 매매 루프 기준 호출량 가정치로 비용 시나리오 산출
- Root cause:
  - 운영 의사결정용 "모델 비교 + 적용 가이드 + 비용 계산식" 문서 부재

## 3. 대응 전략
- 단기 핫픽스:
  - 없음(코드 동작 변경 없이 문서화 중심)
- 근본 해결:
  - Haiku vs GPT-4o-mini 비교 문서를 작성하여 다음을 명시:
    - 실제 사용처(실시간/배치)
    - 장단점(응답 품질, 지연, 비용, 운영 복잡도)
    - 사용량 기준 비용 추정식 및 예시
    - 실시간 경로 권장안/전환 기준
- 안전장치(가드레일/차단/쿨다운/timeout 등):
  - 문서에 모델 전환 시 필수 점검 항목 포함(Timeout, Fallback, 호출량 상한, 에러율 관측)

## 4. 구현/수정 내용
- 변경 파일:
  - `docs/work-result/21-02_llm_model_haiku_vs_gpt4omini_comparison_result.md` (신규)
  - 필요 시 연관 Runbook에 링크 추가
- DB 변경(있다면):
  - 없음
- 주의점:
  - 가격 정보는 변동 가능하므로 공식 소스 기준 확인 시점(날짜) 명시
  - 벤더별 과금 단위(입력/출력/캐시/요청당 최소 과금 등) 차이를 가정 없이 분리 기재

## 5. 검증 기준
- 재현 케이스에서 해결 확인:
  - 문서만 보고 "실시간은 어떤 모델이 적합한지"와 "월 비용 추정"을 계산할 수 있어야 함
- 회귀 테스트:
  - 없음(문서 작업)
- 운영 체크:
  - 코드 사용처 경로와 문서 내용이 1:1 대응되는지 확인
  - 가격 출처 링크가 공식 문서인지 확인

## 6. 롤백
- 코드 롤백:
  - 문서 파일 삭제 또는 이전 버전 복원
- 데이터/스키마 롤백:
  - 없음

## 7. 문서 반영
- work-plan/work-result 업데이트:
  - 본 계획서 + 결과 문서 생성
- PROJECT_CHARTER.md 업데이트 필요 여부 및 반영 내역:
  - 없음(정의/정책 변경 없이 운영 판단 근거 문서 추가)

## 8. 후속 조치
- 다음에 유사 문제 방지를 위한 작업:
  - 월 1회 가격/모델 정책 재검토 루틴 추가 여부 검토
  - 실시간 경로 모델 전환 실험 시 A/B 관측 템플릿화

## 9. 변경 이력 (Plan Changelog)
- 2026-02-26:
  - 사용자 추가 요청 반영: `gpt-4o` 및 Claude Sonnet 미만(Haiku 계열)까지 포함한 확장 비용 비교를 결과 문서 Phase 2로 추가.
- 2026-02-26:
  - 사용자 추가 요청 반영: 월간 호출량 기준 비용표(신호량 시나리오)와 `gpt-4o-mini` 메인 의사결정 전환 시 수정 체크리스트, temperature 설정 현황을 결과 문서에 추가.
